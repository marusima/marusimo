<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Lov zdrav√≠</title>
<style>
body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle at center, #003300, #001100);
    font-family: Arial, sans-serif;
    color: white;
    overflow: hidden;
}

/* Hern√≠ wrapper a sk√≥re */
#game-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 5;
    position: relative;
}

/* Sk√≥re pod hern√≠m polem */
#score {
    font-size: 24px;
    background: rgba(255,255,255,0.1);
    padding: 10px 16px;
    border-radius: 12px;
    margin-top: 15px;
    box-shadow: 0 0 15px #fff;
}

/* Hern√≠ pl√°tno */
#game-container {
    position: relative;
}

#game {
    display: grid;
    grid-template-columns: repeat(20, 60px);
    grid-template-rows: repeat(10, 60px);
    gap: 3px;
    background: rgba(0,50,0,0.8);
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(255,255,255,0.2);
    z-index: 1;
}

.cell {
    width: 60px;
    height: 60px;
    background: radial-gradient(circle at center, #004400 0%, #002200 100%);
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.cell img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
}

/* Modaly */
.modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20,20,30,0.95);
    padding: 30px 40px;
    border-radius: 16px;
    box-shadow: 0 0 20px #fff;
    text-align: center;
    z-index: 100;
}

.modal h2 {
    font-size: 24px;
    margin-bottom: 15px;
}

.modal input {
    font-size: 20px;
    padding: 6px 10px;
    border-radius: 6px;
    border: none;
    margin-bottom: 10px;
    text-align: center;
    width: 80%;
}

.modal button {
    font-size: 20px;
    padding: 8px 20px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #00cc44;
    color: #000;
}
</style>
</head>
<body>

<div id="game-wrapper">
    <div id="game-container">
        <div id="game"></div>
    </div>
    <div id="score">üíö 0 - Dobrodru≈æstv√≠ zaƒç√≠n√°!</div>
</div>

<!-- Game Over Modal -->
<div class="modal" id="gameover-modal">
    <h2 id="gameover-text"></h2>
    <button onclick="restartGame()">Hr√°t znovu</button>
</div>

<!-- √övodn√≠ Modal -->
<div class="modal" id="intro-modal">
    <h2>V√≠tej v Lovu zdrav√≠!</h2>
    <p>Jsi nemocn√Ω ƒçlov√≠ƒçek a sb√≠r√°≈° zdrav√© vƒõci pro sv√© zdrav√≠ üå±</p>
    <p>Ale opatrnƒõ, kolem tebe jsou i vƒõci nezdrav√© üç∑üçîüçπ. Ty tvoji nemoc jen prodlou≈æ√≠.</p>
    <p>Zvol si, kolik zdrav√Ωch vƒõc√≠ si pot≈ôebuje≈° ulovit (1‚Äì15), aby ses uzdravil.</p>
    <input type="number" id="target-input" min="1" max="15" value="5">
    <br>
    <button onclick="startGame()">Chci si ulovit sv√© zdrav√≠!</button>
</div>

<script>
// Hra
const gameWidth = 20;
const gameHeight = 10;
const game = document.getElementById("game");
const scoreEl = document.getElementById("score");
const modal = document.getElementById("gameover-modal");
const gameoverText = document.getElementById("gameover-text");
const introModal = document.getElementById("intro-modal");
const targetInput = document.getElementById("target-input");

const healthyItems = ["clover.png", "tea.png", "ginger.png"];
const unhealthyItems = ["alcohol.png", "alcohol2.png", "coctail.png", "fastfood.png"];

let player = { x: Math.floor(gameWidth/2), y: Math.floor(gameHeight/2) };
let item = null;
let obstacles = [];
let direction = { x:0, y:0 };
let score = 0;
let targetScore = 5;
let gameInterval = null;

introModal.style.display = 'block';

function startGame(){
    const val = parseInt(targetInput.value);
    if(val>=1 && val<=15){
        targetScore = val;
        introModal.style.display='none';
        resetGame();
        if(!gameInterval){
            gameInterval = setInterval(movePlayer, 300);
        }
    } else {
        alert("Zadejte ƒç√≠slo od 1 do 15!");
    }
}

function randomPosition(){
    return { x: Math.floor(Math.random()*gameWidth), y: Math.floor(Math.random()*gameHeight) };
}

function createItem() {
    return { pos: randomPosition(), img: healthyItems[Math.floor(Math.random()*healthyItems.length)] };
}
function createObstacle() {
    return { pos: randomPosition(), img: unhealthyItems[Math.floor(Math.random()*unhealthyItems.length)] };
}

function generateObstacles(){
    const numObs = Math.floor(Math.random()*4)+3; // 3‚Äì6
    let arr=[];
    while(arr.length<numObs){
        let o = createObstacle();
        if(!((o.pos.x===player.x && o.pos.y===player.y) || 
             (o.pos.x===item.pos.x && o.pos.y===item.pos.y)) &&
           !arr.some(e=>e.pos.x===o.pos.x && e.pos.y===o.pos.y)){
            arr.push(o);
        }
    }
    return arr;
}

function drawGame(){
    game.innerHTML='';
    for(let y=0;y<gameHeight;y++){
        for(let x=0;x<gameWidth;x++){
            const cell=document.createElement('div');
            cell.className='cell';

            if(x===player.x && y===player.y){
                const img=document.createElement('img');
                img.src='../static/sick.png';
                img.alt='player';
                cell.appendChild(img);
            } else if(x===item.pos.x && y===item.pos.y){
                const img=document.createElement('img');
                img.src='../static/' + item.img;
                img.alt='healthy';
                cell.appendChild(img);
            } else {
                let obs = obstacles.find(o => o.pos.x===x && o.pos.y===y);
                if(obs){
                    const img=document.createElement('img');
                    img.src='../static/' + obs.img;
                    img.alt='obstacle';
                    cell.appendChild(img);
                }
            }

            game.appendChild(cell);
        }
    }

    let percent = Math.floor((score/targetScore)*100);
    let comment='';
    if(percent===0) comment='üå± Zaƒç√≠n√°me, hodnƒõ zdrav√≠!';
    else if(percent<25) comment='üí™ M√°lo zdrav√≠, sb√≠rej d√°l!';
    else if(percent<50) comment='üåø Skoro polovina cesty, jde to skvƒõle!';
    else if(percent<75) comment='üçµ Jsi v p≈Ølce, dr≈æ se!';
    else if(percent<90) comment='üçÄ Je≈°tƒõ kousek, nep≈ôest√°vej!';
    else if(percent<100) comment='‚ú® Skoro hotovo, posledn√≠ vƒõc!';
    else comment='üèÜ A jsi zdrav√Ω p≈ôesnƒõ jak sl√≠beno!';
    scoreEl.textContent=`üíö ${score}/${targetScore} - ${comment}`;
}

// Pohyb hr√°ƒçe
let warningTimeout = null; // pro hl√°≈°ky

function movePlayer(){
    player.x += direction.x;
    player.y += direction.y;

    if(player.x<0 || player.x>=gameWidth || player.y<0 || player.y>=gameHeight){
        gameOver("üí´ Vyletƒõl jsi mimo zelenou louku a ztr√°c√≠≈° mo≈ænost lovit sv√© zdrav√≠!");
        return;
    }

    let obsHit = obstacles.find(o => o.pos.x===player.x && o.pos.y===player.y);
    if(obsHit){
        score = 0;
        drawGame();
        const originalText = scoreEl.textContent;
        scoreEl.textContent += " ‚ùå Opravdu jsi musel tohle nezdrav√©? Zpomalilo to tvoje uzdravov√°n√≠, snad ti to za to st√°lo.";

        // Pokud u≈æ bƒõ≈æ√≠ timeout, zru≈°it ho
        if(warningTimeout) clearTimeout(warningTimeout);

        warningTimeout = setTimeout(()=>{
            scoreEl.textContent = originalText;
            item = createItem();
            obstacles = generateObstacles();
            drawGame();
        }, 3000); // 3 sekundy
        return;
    }

    if(player.x===item.pos.x && player.y===item.pos.y){
        score++;
        if(score>=targetScore){
            gameOver("üéâ Sb√≠rka zdrav√≠ dokonƒçena! üåü");
            return;
        }
        item = createItem();
        obstacles = generateObstacles();
    }

    drawGame();
}


function gameOver(msg){
    modal.style.display='block';
    gameoverText.textContent=msg;
    direction={x:0,y:0};
}

function restartGame(){
    modal.style.display='none';
    score=0;
    resetGame();
}

function resetGame(){
    player = { x: Math.floor(gameWidth/2), y: Math.floor(gameHeight/2) };
    item = createItem();
    obstacles = generateObstacles();
    direction = {x:0, y:0};
    drawGame();
}

// Ovl√°d√°n√≠ ≈°ipkami
document.addEventListener('keydown', e=>{
    if(e.key==='ArrowUp') direction={x:0,y:-1};
    if(e.key==='ArrowDown') direction={x:0,y:1};
    if(e.key==='ArrowLeft') direction={x:-1,y:0};
    if(e.key==='ArrowRight') direction={x:1,y:0};
});
</script>

</body>
</html>
